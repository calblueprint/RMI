sudo: required
services:
  - docker
before_install:
  - L=$PWD/flynn && curl -sSL -A "`uname -sp`" https://dl.flynn.io/cli | zcat >$L && chmod +x $L
  - export PATH=$PATH:$PWD/
  - flynn cluster add -p $FLYNN_CLUSTER_ADD
  - sudo mkdir -p /etc/docker/certs.d/docker.apps.ethanl.ee
  - sudo cp /home/travis/.flynn/ca-certs/default.pem /etc/docker/certs.d/docker.apps.ethanl.ee/ca.crt
  - sudo service docker stop
  - sudo service docker start
  - flynn docker set-push-url
  - flynn docker login
  - openssl aes-256-cbc -K $encrypted_0bbbfb8288d9_key -iv $encrypted_0bbbfb8288d9_iv -in .env.enc -out .env -d
install: echo "Skipping install step"
script: ./docker_setup.sh
after_script: flynn -a clams-encourage-stormont docker push rmi_web
